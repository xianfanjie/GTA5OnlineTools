name: Auto Exe Build and Publish

on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
  # schedule:
  #   - cron: '0 0 * * *' # æ¯å¤© UTC æ—¶é—´ 00:00 è§¦å‘
env:
  TZ: Asia/Shanghai

jobs:
  build:
    runs-on: ubuntu-latest
    permissions: 
      contents: write
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '6.0.x'
         
    - name: Publish
      run: |
       cd GTA5OnlineTools 
       dotnet publish -c Release -r win-x64 -o release --self-contained true -p:IncludeNativeLibrariesForSelfExtract=true -p:EnableWindowsTargeting=true -p:PublishSingleFile=true -p:DebugType=None
       mv ./release/GTA5OnlineTools.exe ./release/GTA5OnlineTools_selfcontained.exe
       dotnet publish -c Release -r win-x64 -o release --self-contained false -p:EnableWindowsTargeting=true -p:PublishSingleFile=true -p:DebugType=None
      
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: GTA5OnlineTools
        path: GTA5OnlineTools/release

    - name: Create Release tag
      id: tag
      run: |
        release_time=$(date +"%Y-%m-%d-%H%M")
        echo "release_time=$release_time" >> $GITHUB_ENV
             
    - name: Upload Release
      uses: softprops/action-gh-release@v2
      with:
        files: GTA5OnlineTools/release/*
        token: ${{ secrets.GITHUB_TOKEN }}
        name: "${{ env.release_time }} è‡ªåŠ¨æ„å»ºç”Ÿæˆ"
        tag_name: ${{ env.release_time }}
        body: |
          ğŸ‰ **è‡ªåŠ¨æ„å»ºå‘å¸ƒç‰ˆæœ¬**
        
          è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ„å»ºçš„å‘å¸ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼š
        
          ğŸš€ **åŸå§‹åº”ç”¨ç¨‹åºï¼š** [GTA5OnlineTools.exe](https://github.com/${{ github.repository }}/releases/download/${{ env.release_time }}/GTA5OnlineTools.exe)
          ğŸŒŸ **åŒ…å«è¿è¡Œæ—¶ç¯å¢ƒçš„åº”ç”¨ç¨‹åºï¼š** [GTA5OnlineTools_selfcontained.exe](https://github.com/${{ github.repository }}/releases/download/${{ env.release_time }}/GTA5OnlineTools_selfcontained.exe)
